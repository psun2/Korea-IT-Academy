<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>AJAX API서울시 지하철역사정보</title>
    <style>
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 5px;
      }
    </style>
  </head>
  <!--
■서울시 지하철 역사 정보
http://data.seoul.go.kr/dataList/datasetView.do?infId=OA-12753&srvType=A&serviceKind=1&currentPageNo=1

샘플url

XML 버젼
http://swopenAPI.seoul.go.kr/api/subway/키값넣으세요/xml/stationInfo/0/5/서울
예] http://swopenAPI.seoul.go.kr/api/subway/4d46796d7366726f3833774a774955/xml/stationInfo/0/5/서울

JSON 버젼
http://swopenAPI.seoul.go.kr/api/subway/키값넣으세요/json/stationInfo/0/5/서울
예] http://swopenAPI.seoul.go.kr/api/subway/4d46796d7366726f3833774a774955/json/stationInfo/0/5/서울 

 -->
  <body>
    <h1>서울시 지하철 역사 정보</h1>
    <form>
      역명: <input type="text" id="stationname" value="서울" /><br /><br />

      <button type="button" onclick="loadData()">역사정보 가져오기</button>
      <button type="button" onclick="removeTable()">지우기</button>
    </form>
    <br /><br />
    <h2>AJAX + XML</h2>
    <table id="demoXML"></table>
    <hr />
    <h2>AJAX + JSON</h2>
    <table id="demoJSON"></table>

    <script>
      var api_key = '42424f4e48746a6434344575756f68';
      var kind = undefined;
      var url = undefined;
      var startIndex = 0;
      var endIndex = 0;

      function removeTable() {
        document
          .getElementById('demoXML')
          .removeChild(document.getElementById('demoXML').childNodes[0]);
        document
          .getElementById('demoJSON')
          .removeChild(document.getElementById('demoJSON').childNodes[0]);
      }

      function loadData() {
        // TODO: 역사정보 가져오기

        var value = document.getElementById('stationname').value;

        // XML
        kind = 'xml';
        url = `http://swopenAPI.seoul.go.kr/api/subway/${api_key}/${kind}/stationInfo/0/5/${value}`;
        console.log('XML URL :', url);

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 200)
            parseXML(this.responseXML);
        };
        xhttp.open('GET', url, true);
        xhttp.send();

        // JSON
        kind = 'json';
        url = `http://swopenAPI.seoul.go.kr/api/subway/${api_key}/${kind}/stationInfo/0/5/${value}`;
        console.log('JSON URL :', url);

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (this.readyState === 4 && this.status === 200)
            parseJSON(this.responseText);
        };
        xhttp.open('GET', url, true);
        xhttp.send();
      }

      function parseXML(xmlDOM) {
        // TODO:
        var row = xmlDOM.getElementsByTagName('row');
        var rowArr = Array.from(row);
        var table = `<tr><th>역명</th><th>아이디</th><th>호선</th><th>영문명</th></tr>`;
        rowArr.forEach((index) => {
          //   var data = index.children;
          var statnTnm = index.getElementsByTagName('statnTnm')[0].childNodes[0]
            .nodeValue;
          var statnTid = index.getElementsByTagName('statnTid')[0].childNodes[0]
            .nodeValue;
          var subwayNm = index.getElementsByTagName('subwayNm')[0].childNodes[0]
            .nodeValue;
          var statnNmEng = index.getElementsByTagName('statnNmEng')[0]
            .childNodes[0].nodeValue;
          table += `<tr><td>${statnTnm}</td><td>${statnTid}</td><td>${subwayNm}</td><td>${statnNmEng}</td></tr>`;
        });
        document.getElementById('demoXML').innerHTML = table;
      }

      function parseJSON(jsonText) {
        // TODO:
        var obj = JSON.parse(jsonText);
        var stationList = obj.stationList;
        var table = `<tr><th>역명</th><th>아이디</th><th>호선</th><th>영문명</th></tr>`;
        stationList.forEach((index) => {
          var statnTnm = index.statnTnm;
          var statnTid = index.statnTid;
          var subwayNm = index.subwayNm;
          var statnNmEng = index.statnNmEng;
          table += `<tr><td>${statnTnm}</td><td>${statnTid}</td><td>${subwayNm}</td><td>${statnNmEng}</td></tr>`;
        });
        document.getElementById('demoJSON').innerHTML = table;
      }
    </script>

    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
  </body>
</html>
